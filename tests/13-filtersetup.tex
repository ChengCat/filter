% Test filtersetup option

\usemodule[filter]

\def\barcodelabeloption{}

\startsetups barcode:options
  \doifelse{\externalfilterparameter{label}}{no}
    {\edef\barcodelabeloption{-n}}
    {\edef\barcodelabeloption{}}
\stopsetups

\defineexternalfilter
  [barcode]
  [encoding=code128,
   output=\externalfilterbasefile.pdf,
   label=yes,
   checksum=no,
   continue=yes,
   filtersetups={barcode:options},
   filtercommand=\barcodefiltercommand,
   readcommand=\barcodereadcommand]

\def\barcodereadcommand#1%
  {\externalfigure[#1][object=no]}

\unprotected\def\barcodefiltercommand
  {barcode -i \externalfilterinputfile\space -o \externalfilterbasefile.eps\space
   -E % EPS output
   -e \externalfilterparameter{encoding}
   %\doif{\externalfilterparameter{checksum}}\v!no{-c}
   \barcodelabeloption\space
   &&
   epstopdf \externalfilterbasefile.eps --outfile=\externalfilteroutputfile
   }

\traceexternalfilters

\starttext
\inlinebarcode!Hello World!

\placefigure{A Bar code with no label}{\inlinebarcode[label=no]{barcode}}
\stoptext

